<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="什麼是非同步？程式碼的執行分成兩種 —— 同步 (Synchronous) 與非同步 (Asynchronous)。同步顧名思義就是讓程式「依序去執行」各項步驟，相反地，非同步的程式容許我們跳過某一行程式碼繼續往下執行。 舉一個較生活化的例子，假設筆者今天中午出門去買午餐，讀者可以預期這兩種情況：  情形一：先去麵攤購買外帶的牛肉麵，並且在麵攤等待牛肉麵製作完成，取餐後，再去隔壁的飲料店購買飲料。">
<meta property="og:type" content="article">
<meta property="og:title" content="[網頁前端] Asynchronous Programming in JavaScript">
<meta property="og:url" content="http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/index.html">
<meta property="og:site_name" content="Benson Chiu">
<meta property="og:description" content="什麼是非同步？程式碼的執行分成兩種 —— 同步 (Synchronous) 與非同步 (Asynchronous)。同步顧名思義就是讓程式「依序去執行」各項步驟，相反地，非同步的程式容許我們跳過某一行程式碼繼續往下執行。 舉一個較生活化的例子，假設筆者今天中午出門去買午餐，讀者可以預期這兩種情況：  情形一：先去麵攤購買外帶的牛肉麵，並且在麵攤等待牛肉麵製作完成，取餐後，再去隔壁的飲料店購買飲料。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://1.bp.blogspot.com/-jC5hTHXlbZo/X4lTCwDPwNI/AAAAAAAAi0Y/Pbh7GXisVyca_vqmeLWEWzAYjGadHwP_ACNcBGAsYHQ/s0/js-asynchronous-callback-hell-fetch-promise-api-1.jpg">
<meta property="og:image" content="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/promises.png">
<meta property="article:published_time" content="2023-07-26T09:22:30.000Z">
<meta property="article:modified_time" content="2023-07-27T08:56:45.572Z">
<meta property="article:author" content="Benson Chiu">
<meta property="article:tag" content="React">
<meta property="article:tag" content="Next">
<meta property="article:tag" content="JavaScript">
<meta property="article:tag" content="FrontEnd">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://1.bp.blogspot.com/-jC5hTHXlbZo/X4lTCwDPwNI/AAAAAAAAi0Y/Pbh7GXisVyca_vqmeLWEWzAYjGadHwP_ACNcBGAsYHQ/s0/js-asynchronous-callback-hell-fetch-promise-api-1.jpg">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>[網頁前端] Asynchronous Programming in JavaScript</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-G89NYB65CH"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-G89NYB65CH');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/imbensonchiu">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/English/20230726/0725-economist/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/English/20230724/0724-economist/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&text=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&title=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&is_video=false&description=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=[網頁前端] Asynchronous Programming in JavaScript&body=Check out this article: http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&title=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&title=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&title=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&title=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&name=[網頁前端] Asynchronous Programming in JavaScript&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&t=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E9%BA%BC%E6%98%AF%E9%9D%9E%E5%90%8C%E6%AD%A5%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">什麼是非同步？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Callback-Functions"><span class="toc-number">2.</span> <span class="toc-text">Callback Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Event-Handlers"><span class="toc-number">2.1.</span> <span class="toc-text">Event Handlers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Callback-Functions-1"><span class="toc-number">2.2.</span> <span class="toc-text">Callback Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#setTimeOut-%E9%9A%94%E6%9F%90%E4%B8%80%E6%AE%B5%E6%99%82%E9%96%93%E9%81%8E%E5%BE%8C%EF%BC%8C%E5%9F%B7%E8%A1%8C%E6%9F%90%E5%80%8B%E5%87%BD%E6%95%B8"><span class="toc-number">2.2.1.</span> <span class="toc-text">setTimeOut() : 隔某一段時間過後，執行某個函數</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Self-defined-Callbacks-%E8%97%89%E6%AD%A4%E7%A2%BA%E5%AE%9A%E5%87%BD%E6%95%B8%E5%9F%B7%E8%A1%8C%E7%9A%84%E9%A0%86%E5%BA%8F"><span class="toc-number">2.2.2.</span> <span class="toc-text">Self-defined Callbacks: 藉此確定函數執行的順序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Callback-Hell"><span class="toc-number">2.2.3.</span> <span class="toc-text">Callback Hell</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise"><span class="toc-number">3.</span> <span class="toc-text">Promise</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-%E7%B0%A1%E4%BB%8B"><span class="toc-number">3.1.</span> <span class="toc-text">Promise 簡介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-%E7%9A%84%E7%8B%80%E6%85%8B"><span class="toc-number">3.2.</span> <span class="toc-text">Promise 的狀態</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-%E7%9A%84%E6%88%90%E5%93%A1%E5%87%BD%E6%95%B8"><span class="toc-number">3.3.</span> <span class="toc-text">Promise 的成員函數</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Promise-then"><span class="toc-number">3.3.1.</span> <span class="toc-text">Promise.then()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Promise-catch"><span class="toc-number">3.3.2.</span> <span class="toc-text">Promise.catch()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">3.4.</span> <span class="toc-text">Promise 的初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-behavior-of-resolve-functions"><span class="toc-number">3.4.1.</span> <span class="toc-text">The behavior of resolve functions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-%E7%9A%84%E7%89%B9%E6%80%A7"><span class="toc-number">3.5.</span> <span class="toc-text">Promise 的特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-%E7%9A%84%E5%90%88%E6%88%90"><span class="toc-number">3.6.</span> <span class="toc-text">Promise 的合成</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Promise-all"><span class="toc-number">3.6.1.</span> <span class="toc-text">Promise.all()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%94%A8%E6%B3%95%EF%BC%9APromise-allSettled-Promise-any-%E8%88%87-Promise-race"><span class="toc-number">3.6.2.</span> <span class="toc-text">其他用法：Promise.allSettled(), Promise.any(), 與 Promise.race()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Async-Function"><span class="toc-number">4.</span> <span class="toc-text">Async Function</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Comparison"><span class="toc-number">4.1.</span> <span class="toc-text">Comparison</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%87%89%E7%94%A8%EF%BC%9A%E5%90%8C%E6%99%82%E7%94%A8%E5%85%A9%E5%80%8B-API-%E6%8A%93%E5%8F%96%E8%B3%87%E6%96%99"><span class="toc-number">4.2.</span> <span class="toc-text">應用：同時用兩個 API 抓取資料</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">5.</span> <span class="toc-text">References</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        [網頁前端] Asynchronous Programming in JavaScript
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Benson Chiu</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-07-26T09:22:30.000Z" class="dt-published" itemprop="datePublished">2023-07-26</time>
        
        (Updated: <time datetime="2023-07-27T08:56:45.572Z" class="dt-updated" itemprop="dateModified">2023-07-27</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Computer-Science/">Computer Science</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/FrontEnd/" rel="tag">FrontEnd</a>, <a class="p-category" href="/tags/JavaScript/" rel="tag">JavaScript</a>, <a class="p-category" href="/tags/Next/" rel="tag">Next</a>, <a class="p-category" href="/tags/React/" rel="tag">React</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="什麼是非同步？"><a href="#什麼是非同步？" class="headerlink" title="什麼是非同步？"></a>什麼是非同步？</h2><p>程式碼的執行分成兩種 —— <strong>同步 (Synchronous) 與非同步 (Asynchronous)<strong>。</strong>同步</strong>顧名思義就是讓程式「依序去執行」各項步驟，相反地，<strong>非同步</strong>的程式容許我們<strong>跳過某一行程式碼繼續往下執行</strong>。</p>
<p>舉一個較生活化的例子，假設筆者今天中午出門去買午餐，讀者可以預期這兩種情況：</p>
<ul>
<li><strong>情形一：</strong>先去麵攤購買外帶的牛肉麵，並且在麵攤等待牛肉麵製作完成，取餐後，再去隔壁的飲料店購買飲料。</li>
<li><strong>情形二：</strong>先去麵攤購買外帶的牛肉麵，趁牛肉麵製作的過程中去隔壁的飲料店購買飲料，之後看哪一邊先做完就先去拿已經做完的品項。</li>
</ul>
<p><strong>情形一 <strong>按照步驟（點餐 -&gt; 取餐 -&gt; 點餐 -&gt; 取餐）一步一步來，是</strong>同步程式</strong>的典型案例；而<strong>情形二</strong>在前面一家店尚未結束而需要等待時跳躍到下一個步驟執行，具有<strong>非同步程式</strong>的概念。顯然地，<strong>情形二</strong>相較於<strong>情形一</strong>更有效率。</p>
<p>在開發網頁應用程式時亦是如此 —— <strong>非同步程式</strong>相較於<strong>同步程式</strong>在許多情況會有更佳的表現。舉例來說，我們常常會有<strong>透過 API 抓取或傳輸資料</strong>的需求，當資料量非常大時，往往要耗費<strong>較多的時間</strong>。倘若我們採用<strong>同步程式</strong>，在遇到某一個 API 操作時，程式<strong>必須要等待該操作結束</strong>才能繼續執行接下來的敘述，若該操作相當耗時，程式便難逃<strong>「大塞車」</strong>的厄運。相反地，透過<strong>非同步程式</strong>，程式得以在 API 操作執行時<strong>暫時先繼續執行底下的其他敘述</strong>，然後在該操作結束後存取 API 回傳的資料。</p>
<h2 id="Callback-Functions"><a href="#Callback-Functions" class="headerlink" title="Callback Functions"></a>Callback Functions</h2><h3 id="Event-Handlers"><a href="#Event-Handlers" class="headerlink" title="Event Handlers"></a>Event Handlers</h3><p>當事件 (Event) 發生時（例如：點擊按鈕、提交表單），Event Handler 才會被執行，而非傳入時立即執行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function handleClick() &#123;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;button ... onClick=&#123;handleClick&#125;&gt; Click Me &lt;/button&gt;</span><br></pre></td></tr></table></figure>

<p>以上述 React.js 的程式碼片段為例，我們將名為 <code>handleClick</code> 的函數傳入 <code>button</code> 中 <code>onClick</code> 的 attribute 當中。在將 <code>handleClick</code> 函數傳入 <code>onClick</code>  時，其並<strong>不會立即執行，而是</strong>待到該按鈕被游標觸發時才被呼叫。</p>
<p>在 JavaScript 的 DOM 中，我們亦可以透過 <code>Obj.addEventListener()</code> 討論 Event Handler 的用法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">buttonElement.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;Element clicked through function!&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>第一個參數，我們傳入的是<strong>「事件的名稱」</strong>，第二個參數則是與  <code>handleClick</code> 類似的 <strong>Event Handler 函數</strong>。相同地，當我們傳入這個函數時，它並不會立即被呼叫，而是會<strong>等待至事件發生時</strong>。</p>
<h3 id="Callback-Functions-1"><a href="#Callback-Functions-1" class="headerlink" title="Callback Functions"></a>Callback Functions</h3><p>若我們更廣義地去討論 Event Handlers，我們可以發現其實它是 JavaScript 中 <strong>Callbacks</strong> 中的其中一種。定義上， callback 是一個<strong>型態為函數</strong>的**函數參數 (parameter)**，且該函數將來會在某個時間點於函式主體內被呼叫。換句話說，若我們將某一個函數傳入到另一個函數中，且預期該函數隨後符合條件時會被呼叫，這個被傳入的函數即被稱為 callback。</p>
<h4 id="setTimeOut-隔某一段時間過後，執行某個函數"><a href="#setTimeOut-隔某一段時間過後，執行某個函數" class="headerlink" title="setTimeOut() : 隔某一段時間過後，執行某個函數"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/setTimeout"><code>setTimeOut()</code></a> : 隔某一段時間過後，執行某個函數</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(functionRef, delay)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Delayed for 1 second.&quot;</span>);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<h4 id="Self-defined-Callbacks-藉此確定函數執行的順序"><a href="#Self-defined-Callbacks-藉此確定函數執行的順序" class="headerlink" title="Self-defined Callbacks: 藉此確定函數執行的順序"></a>Self-defined Callbacks: 藉此確定函數執行的順序</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">funcA</span>(<span class="params">callback</span>)&#123;</span><br><span class="line">  ....</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Function A&quot;</span>)</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">callback</span>();</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">funcB</span>(<span class="params"></span>)&#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Function B&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="title function_">funcA</span>(funcB) <span class="comment">//Pass funcB to funcA as a callback</span></span><br></pre></td></tr></table></figure>

<p>透過上述的程式碼，無論 <code>funcA</code> 要等多久，<code>funcB</code> 都會等到 <code>funcA</code> 結束後才執行。</p>
<h4 id="Callback-Hell"><a href="#Callback-Hell" class="headerlink" title="Callback Hell"></a>Callback Hell</h4><p>若我們要確切決定多個函數的執行順序，必須得要使用**多個 callback **實現該效果。然而，這會讓程式碼極為不美觀並缺乏易讀性，這就是所謂 <strong>Callback Hell</strong> 的由來。</p>
<img src="https://1.bp.blogspot.com/-jC5hTHXlbZo/X4lTCwDPwNI/AAAAAAAAi0Y/Pbh7GXisVyca_vqmeLWEWzAYjGadHwP_ACNcBGAsYHQ/s0/js-asynchronous-callback-hell-fetch-promise-api-1.jpg" alt="前端JS 如何避免callback 地獄？Fetch API 及Promie 使用技巧＠WFU BLOG" style="zoom: 50%;" />

<p><a target="_blank" rel="noopener" href="https://www.wfublog.com/2020/10/js-asynchronous-callback-hell-fetch-promise-api.html">圖片來源：前端 JS 如何避免 callback 地獄？Fetch API 及 Promie 使用技巧＠WFU BLOG</a></p>
<h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><h3 id="Promise-簡介"><a href="#Promise-簡介" class="headerlink" title="Promise 簡介"></a>Promise 簡介</h3><p><a target="_blank" rel="noopener" href="https://www.fooish.com/javascript/ES6/">JavaScript ES6</a> 推出了  <strong>Promise 物件</strong>，旨在解決複雜的<strong>非同步程式</strong>。</p>
<p>原先，我們只能使用 <strong>callback function</strong> 實作非同步程式。在上一節有提及，當我們要確切決定多個函數的執行順序時，使用這個方法可能會有 <strong>Callback Hell</strong> 的情形產生，以下述 3 層的非同步程式碼片段為例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">doSomething</span>(<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">  <span class="title function_">doSomethingElse</span>(result, <span class="keyword">function</span> (<span class="params">newResult</span>) &#123;</span><br><span class="line">    <span class="title function_">doThirdThing</span>(newResult, <span class="keyword">function</span> (<span class="params">finalResult</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Got the final result: <span class="subst">$&#123;finalResult&#125;</span>`</span>);</span><br><span class="line">    &#125;, failureCallback);</span><br><span class="line">  &#125;, failureCallback);</span><br><span class="line">&#125;, failureCallback);</span><br></pre></td></tr></table></figure>

<p> 透過 <strong>Promise</strong> 物件，我們可以改寫如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">doSomething</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">doSomethingElse</span>(result);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">newResult</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">doThirdThing</span>(newResult);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">finalResult</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Got the final result: <span class="subst">$&#123;finalResult&#125;</span>`</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(failureCallback);</span><br></pre></td></tr></table></figure>

<p>透過與**箭頭函數 (arrow functions) **的搭配，我們可以將以上的程式碼再度簡化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">doSomething</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> <span class="title function_">doSomethingElse</span>(result))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">newResult</span>) =&gt;</span> <span class="title function_">doThirdThing</span>(newResult))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">finalResult</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Got the final result: <span class="subst">$&#123;finalResult&#125;</span>`</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(failureCallback);</span><br></pre></td></tr></table></figure>

<p>我們可以藉此<strong>大幅減少原先 callback hell 的巢狀結構</strong>，讓非同步程式變得更清晰、易讀、好維護。</p>
<h3 id="Promise-的狀態"><a href="#Promise-的狀態" class="headerlink" title="Promise 的狀態"></a>Promise 的狀態</h3><ul>
<li><em><strong>pending</strong></em>: 最初狀態 (neither <em>fulfilled</em> nor <em>rejected</em>)</li>
<li><em><strong>fulfilled</strong></em>: promise 物件中的操作成功地被執行</li>
<li><em><strong>rejected</strong></em>: promise 物件中的操作「並未」成功地被執行</li>
</ul>
<p>promise 物件的<strong>最終狀態</strong>必定是 <em>fulfilled</em> 和 <em>rejected</em> 的其中一種，我們稱 <em>“the promise <strong>has been settled</strong>“</em>.</p>
<img src="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/promises.png" alt="Flowchart showing how the Promise state transitions between pending, fulfilled, and rejected via then/catch handlers. A pending promise can become either fulfilled or rejected. If fulfilled, the &quot;on fulfillment&quot; handler, or first parameter of the then() method, is executed and carries out further asynchronous actions. If rejected, the error handler, either passed as the second parameter of the then() method or as the sole parameter of the catch() method, gets executed." style="zoom:67%;" />

<p>上圖是 promise 物件流程處理的<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise#description">簡要圖解</a></p>
<h3 id="Promise-的成員函數"><a href="#Promise-的成員函數" class="headerlink" title="Promise 的成員函數"></a>Promise 的成員函數</h3><h4 id="Promise-then"><a href="#Promise-then" class="headerlink" title="Promise.then()"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/then#parameters"><code>Promise.then()</code></a></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">then</span>(onFulfilled)</span><br><span class="line"><span class="title function_">then</span>(onFulfilled, onRejected)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>onFulfilled</code>: <ul>
<li>當該 promise 物件的狀態為 <em>fulfilled</em>，<strong>隨後</strong>執行傳入此格的函數</li>
<li>參數：promise 物件的狀態為 <em>fulfilled</em> 時所<strong>回傳的值</strong></li>
<li>回傳值：作為 <code>promise.then()</code> 的這一個 promise 狀態為 <em>fulfilled</em> 時所<strong>回傳的值</strong></li>
</ul>
</li>
<li><code>onRejected</code>:<ul>
<li>當該 promise 物件的狀態為 <em>rejected</em>，<strong>隨後</strong>執行傳入此格的函數</li>
<li>參數：promise 物件的狀態為 <em>rejected</em> 的原因</li>
<li>回傳值：作為 <code>promise.catch()</code>的這一個 promise 狀態為 <em>fulfilled</em> 所<strong>回傳的值</strong></li>
</ul>
</li>
<li><strong>[討論]</strong> 當一個 Handler Function<ul>
<li>回傳一個值：<ul>
<li>promise 的狀態為 <em>fulfilled</em> ，並回傳該值</li>
</ul>
</li>
<li>沒有回傳值：<ul>
<li>promise 的狀態為 <em>fulfilled</em> ，並回傳 undefined</li>
</ul>
</li>
<li>丟出錯誤：<ul>
<li>promise 的狀態為 <em>rejected</em> ，並丟出錯誤作為其值</li>
</ul>
</li>
<li>回傳一個狀態為 <em>fulfilled</em> 的 promise：<ul>
<li>promise 的狀態為 <em>fulfilled</em> ，並且回傳該 promise 的回傳值</li>
</ul>
</li>
<li>回傳一個狀態為 <em>rejected</em> 的 promise：<ul>
<li>promise 的狀態為 <em>rejected</em> ，並且回傳該 promise 的回傳值</li>
</ul>
</li>
<li>回傳一個狀態為 <em>pending</em> 的 promise：<ul>
<li>promise 的狀態為 <em>pending</em> ，等待上一個 promise 的結果</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Promise-catch"><a href="#Promise-catch" class="headerlink" title="Promise.catch()"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/catch"><code>Promise.catch()</code></a></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">catch</span>(onRejected)</span><br></pre></td></tr></table></figure>

<p>其等價於</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">then</span>(<span class="literal">undefined</span>, onRejected)</span><br></pre></td></tr></table></figure>



<h3 id="Promise-的初始化"><a href="#Promise-的初始化" class="headerlink" title="Promise 的初始化"></a>Promise 的初始化</h3><p>我們可以使用 Promise 物件的<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/Promise">建構子 (constructor)</a>對其進行初始化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line">  &#125;, <span class="number">300</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise1.<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="comment">//resolve</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">  <span class="comment">// Expected output: &quot;foo&quot;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="The-behavior-of-resolve-functions"><a href="#The-behavior-of-resolve-functions" class="headerlink" title="The behavior of resolve functions"></a>The behavior of <code>resolve</code> functions</h4><ul>
<li>引數和新建立的 promise 物件相同 (the promise it’s <em>tethered to</em>)，promise 物件的狀態為 <em>rejected</em> 並回傳 <code>TypeError</code></li>
<li>引數是 <strong>non-thenable value</strong><ul>
<li>promise 物件的狀態為 <em>fulfilled</em>，且<strong>該 promise 的值即為該引數</strong></li>
</ul>
</li>
<li>引數是 <strong>thenable value</strong><ul>
<li>該引述的 <code>.then()</code> 被「儲存」並在未來被呼叫</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//They are roughly equivalent</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(thenable);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    thenable.<span class="title function_">then</span>(</span><br><span class="line">      <span class="function">(<span class="params">value</span>) =&gt;</span> <span class="title function_">resolve</span>(value),</span><br><span class="line">      <span class="function">(<span class="params">reason</span>) =&gt;</span> <span class="title function_">reject</span>(reason),</span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="title function_">reject</span>(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Promise-的特性"><a href="#Promise-的特性" class="headerlink" title="Promise 的特性"></a>Promise 的特性</h3><ul>
<li><p><strong>務必在每一個 <code>.then()</code> 中都回傳該段敘述的結果</strong>， 並且當作下一個 <code>then()</code>中 callback 的引數</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> listOfIngredients = [];</span><br><span class="line"></span><br><span class="line"><span class="title function_">doSomething</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">url</span>) =&gt;</span></span><br><span class="line">    <span class="title function_">fetch</span>(url)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        listOfIngredients.<span class="title function_">push</span>(data);</span><br><span class="line">      &#125;),</span><br><span class="line">  )</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(listOfIngredients);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// OR</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">doSomething</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">url</span>) =&gt;</span> <span class="title function_">fetch</span>(url))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    listOfIngredients.<span class="title function_">push</span>(data);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(listOfIngredients);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>可以在 <code>.catch()</code> 後面繼續放 <code>.then()</code>，來表示吃到錯誤以後還是要執行的動作</p>
</li>
<li><p><strong>[常見錯誤：](<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises#common_mistakes">Using promises - JavaScript | MDN (mozilla.org)</a>)</strong></p>
<ul>
<li>不必要的<strong>巢狀結構</strong></li>
<li>內層的 promise <strong>忘記回傳</strong></li>
<li>忘記在最後以 <code>.catch()</code> 作結</li>
</ul>
</li>
</ul>
<h3 id="Promise-的合成"><a href="#Promise-的合成" class="headerlink" title="Promise 的合成"></a>Promise 的合成</h3><h4 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all()"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises#common_mistakes"><code>Promise.all()</code></a></h4><ul>
<li>同時執行 <code>func1</code>, <code>func2</code> 和 <code>func3</code>，並且等待三者皆執行完畢回傳結果後繼續往下</li>
<li>若其中一個 promise 被拒絕，<code>Promise.all()</code> 會其內<strong>拒絕所有的</strong> promise 並中斷操作</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([<span class="title function_">func1</span>(), <span class="title function_">func2</span>(), <span class="title function_">func3</span>()]).<span class="title function_">then</span>(<span class="function">(<span class="params">[result1, result2, result3]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// use result1, result2 and result3</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="其他用法：Promise-allSettled-Promise-any-與-Promise-race"><a href="#其他用法：Promise-allSettled-Promise-any-與-Promise-race" class="headerlink" title="其他用法：Promise.allSettled(), Promise.any(), 與 Promise.race()"></a>其他用法：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled"><code>Promise.allSettled()</code></a>, <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/any"><code>Promise.any()</code></a>, 與 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/race"><code>Promise.race()</code></a></h4><h2 id="Async-Function"><a href="#Async-Function" class="headerlink" title="Async Function"></a>Async Function</h2><p>Promise 的簡化寫法，宣告時在 function 前標註 <code>async</code> 關鍵字，而函數本體<strong>會回傳 promise 物件</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">name</span>(<span class="params">param0</span>) &#123;</span><br><span class="line">  statements</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">name</span>(<span class="params">param0, param1</span>) &#123;</span><br><span class="line">  statements</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">name</span>(<span class="params">param0, param1, <span class="comment">/* … ,*/</span> paramN</span>) &#123;</span><br><span class="line">  statements</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>函數內部可以放置 <strong>0 或 多個</strong> <code>await</code> 關鍵字，該關鍵字可以使得函數內部以<strong>看似同步</strong>的形式依序執行，而 <code>await</code> 敘述所回傳的是其所「標註」之 promise 物件的回傳值</li>
<li>在每一個 <code>await</code> 後面的程式碼敘述，我們都可以視其為 promise 物件中的 <code>.then()</code></li>
<li><strong>例外處理：</strong>與 promise 物件不同，我們可以直接對 <code>async</code> 和 <code>await</code> 套用 <code>try</code>&#x2F;<code>catch</code></li>
<li>Remark: <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Promise/resolve"><code>Promise.resolve()</code></a> “resolves” a given value to a promise</li>
</ul>
<h3 id="Comparison"><a href="#Comparison" class="headerlink" title="Comparison"></a>Comparison</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//They are similar</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//They are equivalent</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">1</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="literal">undefined</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> result1 = <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;1&quot;</span>)),</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> result2 = <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;2&quot;</span>)),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>();</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>「同步」</strong>進入 <code>foo()</code> 函數，裡面目前每一個 <code>await</code> 都是屬於 <em>pending</em> 狀態，<code>foo()</code> 內部的敘述暫停執行</li>
<li>第一個 <code>await</code>  <em>fulfilled</em> 或 <em>rejected</em>，控制權回到 <code>foo()</code> 內部。倘若其狀態為 <em>fulfilled</em>，<code>await</code> 回傳 1 且將值指派給 <code>result1</code>。若此時第二個 <code>await</code> 還沒 <em>settled</em>，<code>foo()</code> 內部的敘述繼續暫停執行。</li>
<li>第二個 <code>await</code>  <em>fulfilled</em> 或 <em>rejected</em>，控制權回到 <code>foo()</code> 內部。倘若其狀態為 <em>fulfilled</em>，<code>await</code> 回傳 2 且將值指派給 <code>result2</code>。</li>
<li>所有 <code>await</code> 處理完畢，<code>foo()</code> 函數回傳 (在此處為 undefined)。</li>
</ol>
<h3 id="應用：同時用兩個-API-抓取資料"><a href="#應用：同時用兩個-API-抓取資料" class="headerlink" title="應用：同時用兩個 API 抓取資料"></a>應用：同時用兩個 API 抓取資料</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WRONG!</span></span><br><span class="line"><span class="keyword">const</span> artistData = <span class="title function_">getArtist</span>(username)</span><br><span class="line"><span class="keyword">const</span> albumsData = <span class="title function_">getArtistAlbums</span>(username)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [artist, albums] = [<span class="keyword">await</span> artistData, <span class="keyword">await</span> albumsData]</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CORRECT!</span></span><br><span class="line"><span class="comment">// Initiate both requests in parallel</span></span><br><span class="line"><span class="keyword">const</span> artistData = <span class="title function_">getArtist</span>(username)</span><br><span class="line"><span class="keyword">const</span> albumsData = <span class="title function_">getArtistAlbums</span>(username)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Wait for the promises to resolve</span></span><br><span class="line"><span class="keyword">const</span> [artist, albums] = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([artistData, albumsData])</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/building-your-application/data-fetching/fetching#parallel-data-fetching">Data Fetching: Fetching | Next.js (nextjs.org)</a></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10208174">Day21-非同步與同步！基本觀念與應用 - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天 (ithome.com.tw)</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Introducing">Introducing asynchronous JavaScript - Learn web development | MDN (mozilla.org)</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises#chaining">Using promises - JavaScript | MDN (mozilla.org)</a></li>
<li><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10192739">重新認識 JavaScript: Day 18 Callback Function 與 IIFE - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天 (ithome.com.tw)</a></li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/imbensonchiu">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E9%BA%BC%E6%98%AF%E9%9D%9E%E5%90%8C%E6%AD%A5%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">什麼是非同步？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Callback-Functions"><span class="toc-number">2.</span> <span class="toc-text">Callback Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Event-Handlers"><span class="toc-number">2.1.</span> <span class="toc-text">Event Handlers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Callback-Functions-1"><span class="toc-number">2.2.</span> <span class="toc-text">Callback Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#setTimeOut-%E9%9A%94%E6%9F%90%E4%B8%80%E6%AE%B5%E6%99%82%E9%96%93%E9%81%8E%E5%BE%8C%EF%BC%8C%E5%9F%B7%E8%A1%8C%E6%9F%90%E5%80%8B%E5%87%BD%E6%95%B8"><span class="toc-number">2.2.1.</span> <span class="toc-text">setTimeOut() : 隔某一段時間過後，執行某個函數</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Self-defined-Callbacks-%E8%97%89%E6%AD%A4%E7%A2%BA%E5%AE%9A%E5%87%BD%E6%95%B8%E5%9F%B7%E8%A1%8C%E7%9A%84%E9%A0%86%E5%BA%8F"><span class="toc-number">2.2.2.</span> <span class="toc-text">Self-defined Callbacks: 藉此確定函數執行的順序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Callback-Hell"><span class="toc-number">2.2.3.</span> <span class="toc-text">Callback Hell</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise"><span class="toc-number">3.</span> <span class="toc-text">Promise</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-%E7%B0%A1%E4%BB%8B"><span class="toc-number">3.1.</span> <span class="toc-text">Promise 簡介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-%E7%9A%84%E7%8B%80%E6%85%8B"><span class="toc-number">3.2.</span> <span class="toc-text">Promise 的狀態</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-%E7%9A%84%E6%88%90%E5%93%A1%E5%87%BD%E6%95%B8"><span class="toc-number">3.3.</span> <span class="toc-text">Promise 的成員函數</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Promise-then"><span class="toc-number">3.3.1.</span> <span class="toc-text">Promise.then()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Promise-catch"><span class="toc-number">3.3.2.</span> <span class="toc-text">Promise.catch()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">3.4.</span> <span class="toc-text">Promise 的初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-behavior-of-resolve-functions"><span class="toc-number">3.4.1.</span> <span class="toc-text">The behavior of resolve functions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-%E7%9A%84%E7%89%B9%E6%80%A7"><span class="toc-number">3.5.</span> <span class="toc-text">Promise 的特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-%E7%9A%84%E5%90%88%E6%88%90"><span class="toc-number">3.6.</span> <span class="toc-text">Promise 的合成</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Promise-all"><span class="toc-number">3.6.1.</span> <span class="toc-text">Promise.all()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%94%A8%E6%B3%95%EF%BC%9APromise-allSettled-Promise-any-%E8%88%87-Promise-race"><span class="toc-number">3.6.2.</span> <span class="toc-text">其他用法：Promise.allSettled(), Promise.any(), 與 Promise.race()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Async-Function"><span class="toc-number">4.</span> <span class="toc-text">Async Function</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Comparison"><span class="toc-number">4.1.</span> <span class="toc-text">Comparison</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%87%89%E7%94%A8%EF%BC%9A%E5%90%8C%E6%99%82%E7%94%A8%E5%85%A9%E5%80%8B-API-%E6%8A%93%E5%8F%96%E8%B3%87%E6%96%99"><span class="toc-number">4.2.</span> <span class="toc-text">應用：同時用兩個 API 抓取資料</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">5.</span> <span class="toc-text">References</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&text=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&title=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&is_video=false&description=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=[網頁前端] Asynchronous Programming in JavaScript&body=Check out this article: http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&title=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&title=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&title=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&title=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&name=[網頁前端] Asynchronous Programming in JavaScript&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://bensonchiulearning.github.io/Computer-Science/20230726/0725-async-await/&t=[網頁前端] Asynchronous Programming in JavaScript"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023
    Benson Chiu
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/imbensonchiu">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
