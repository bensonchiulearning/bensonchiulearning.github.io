<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="本學習筆記對應至 React 官方文件 - Managing State  State 的五大使用原則Choosing the State Structure – React  盡量將功能相近的多個 state 合併成一個 單獨的 state 避免多個 state之間產生矛盾 避免冗余的 state 避免讓 state 所表示的物件發生複製 避免過度多層的 state  Components 間">
<meta property="og:type" content="article">
<meta property="og:title" content="[網頁前端] React 學習筆記 - Managing States">
<meta property="og:url" content="http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/index.html">
<meta property="og:site_name" content="Benson Chiu">
<meta property="og:description" content="本學習筆記對應至 React 官方文件 - Managing State  State 的五大使用原則Choosing the State Structure – React  盡量將功能相近的多個 state 合併成一個 單獨的 state 避免多個 state之間產生矛盾 避免冗余的 state 避免讓 state 所表示的物件發生複製 避免過度多層的 state  Components 間">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://react.dev/_next/image?url=/images/docs/diagrams/preserving_state_dom_tree.png&w=1920&q=75">
<meta property="og:image" content="https://react.dev/_next/image?url=%2Fimages%2Fdocs%2Fdiagrams%2Fpreserving_state_increment.png&w=1080&q=75">
<meta property="og:image" content="https://react.dev/_next/image?url=%2Fimages%2Fdocs%2Fdiagrams%2Fpreserving_state_same_component.png&w=1200&q=75">
<meta property="og:image" content="https://react.dev/_next/image?url=%2Fimages%2Fdocs%2Fdiagrams%2Fpreserving_state_diff_pt1.png&w=1920&q=75">
<meta property="og:image" content="https://react.dev/_next/image?url=%2Fimages%2Fdocs%2Fdiagrams%2Fpreserving_state_diff_pt2.png&w=1920&q=75">
<meta property="og:image" content="https://react.dev/_next/image?url=%2Fimages%2Fdocs%2Fdiagrams%2Fpreserving_state_diff_position_p1.png&w=1080&q=75">
<meta property="og:image" content="https://react.dev/_next/image?url=%2Fimages%2Fdocs%2Fdiagrams%2Fpreserving_state_diff_position_p2.png&w=1080&q=75">
<meta property="og:image" content="https://react.dev/_next/image?url=%2Fimages%2Fdocs%2Fdiagrams%2Fpreserving_state_diff_position_p3.png&w=1080&q=75">
<meta property="article:published_time" content="2023-07-27T07:10:22.615Z">
<meta property="article:modified_time" content="2023-07-27T09:44:00.346Z">
<meta property="article:author" content="Benson Chiu">
<meta property="article:tag" content="React">
<meta property="article:tag" content="JavaScript">
<meta property="article:tag" content="FrontEnd">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://react.dev/_next/image?url=/images/docs/diagrams/preserving_state_dom_tree.png&w=1920&q=75">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>[網頁前端] React 學習筆記 - Managing States</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-G89NYB65CH"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-G89NYB65CH');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/imbensonchiu">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/English/20230726/0725-economist/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&text=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&title=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&is_video=false&description=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=[網頁前端] React 學習筆記 - Managing States&body=Check out this article: http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&title=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&title=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&title=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&title=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&name=[網頁前端] React 學習筆記 - Managing States&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&t=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#State-%E7%9A%84%E4%BA%94%E5%A4%A7%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%89%87"><span class="toc-number">1.</span> <span class="toc-text">State 的五大使用原則</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Components-%E9%96%93%E5%85%B1%E4%BA%AB-state-%E7%9A%84%E6%A9%9F%E5%88%B6"><span class="toc-number">2.</span> <span class="toc-text">Components 間共享 state 的機制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%87-state-%E6%8A%AC%E5%8D%87%E7%9A%84%E4%B8%89%E5%80%8B%E6%AD%A5%E9%A9%9F"><span class="toc-number">2.1.</span> <span class="toc-text">將 state 抬升的三個步驟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%9CSingle-Source-of-Truth%E2%80%9D-Architecture"><span class="toc-number">2.2.</span> <span class="toc-text">“Single Source of Truth” Architecture</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%9D%E7%95%99%E8%88%87%E9%87%8D%E8%A8%AD-state-%E7%9A%84%E6%A9%9F%E5%88%B6"><span class="toc-number">3.</span> <span class="toc-text">保留與重設 state 的機制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Reducer-%E6%96%BC-State"><span class="toc-number">4.</span> <span class="toc-text">使用 Reducer 於 State</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8-Context-%E5%82%B3%E9%81%9E%E8%B3%87%E6%96%99"><span class="toc-number">5.</span> <span class="toc-text">用 Context 傳遞資料</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Reducer-%E6%96%BC-Context"><span class="toc-number">6.</span> <span class="toc-text">使用 Reducer 於 Context</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        [網頁前端] React 學習筆記 - Managing States
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Benson Chiu</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-07-27T07:10:22.615Z" class="dt-published" itemprop="datePublished">2023-07-27</time>
        
        (Updated: <time datetime="2023-07-27T09:44:00.346Z" class="dt-updated" itemprop="dateModified">2023-07-27</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Computer-Science/">Computer Science</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/FrontEnd/" rel="tag">FrontEnd</a>, <a class="p-category" href="/tags/JavaScript/" rel="tag">JavaScript</a>, <a class="p-category" href="/tags/React/" rel="tag">React</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <blockquote>
<p>本學習筆記對應至 <a target="_blank" rel="noopener" href="https://react.dev/learn/managing-state">React 官方文件 - Managing State</a></p>
</blockquote>
<h2 id="State-的五大使用原則"><a href="#State-的五大使用原則" class="headerlink" title="State 的五大使用原則"></a>State 的五大使用原則</h2><p><a target="_blank" rel="noopener" href="https://react.dev/learn/choosing-the-state-structure">Choosing the State Structure – React</a></p>
<ol>
<li>盡量將功能相近的<strong>多個 state</strong> 合併成一個 <strong>單獨的 state</strong></li>
<li>避免<strong>多個 state</strong>之間產生<strong>矛盾</strong></li>
<li>避免<strong>冗余的 state</strong></li>
<li>避免<strong>讓 state 所表示的物件發生複製</strong></li>
<li>避免<strong>過度多層的 state</strong></li>
</ol>
<h2 id="Components-間共享-state-的機制"><a href="#Components-間共享-state-的機制" class="headerlink" title="Components 間共享 state 的機制"></a>Components 間共享 state 的機制</h2><p><a target="_blank" rel="noopener" href="https://react.dev/learn/sharing-state-between-components#step-2-pass-hardcoded-data-from-the-common-parent">Sharing State Between Components – React</a></p>
<ul>
<li>若我們想要用一個 state 變數同時改變兩個 components ，我們可以將 state 變數宣告於兩者<strong>最接近的 parent element 上</strong>，我們稱其為<strong>將 state 抬升 (lifting state up)</strong></li>
</ul>
<h3 id="將-state-抬升的三個步驟"><a href="#將-state-抬升的三個步驟" class="headerlink" title="將 state 抬升的三個步驟"></a>將 state 抬升的三個步驟</h3><ol>
<li>將 child component 的 <code>useState</code> 敘述移除，改而<strong>以 prop 的方式</strong>傳入 state 變數</li>
<li>在 parent component 傳入<strong>已經寫死的 (hardcoded)</strong> state 變數給 child components</li>
<li>在 parent component 使用<code>useState</code> 初始化 state 變數</li>
</ol>
<h3 id="“Single-Source-of-Truth”-Architecture"><a href="#“Single-Source-of-Truth”-Architecture" class="headerlink" title="“Single Source of Truth” Architecture"></a>“Single Source of Truth” Architecture</h3><ul>
<li>對於每一個 state，他們可以作用於多個 component ，但必須只有唯一一個其<strong>所屬的 component</strong></li>
<li>Instead of duplicating shared state between components, <em>lift it up</em> to their common shared parent, and <em>pass it down</em> to the children that need it.</li>
</ul>
<h2 id="保留與重設-state-的機制"><a href="#保留與重設-state-的機制" class="headerlink" title="保留與重設 state 的機制"></a>保留與重設 state 的機制</h2><p><a target="_blank" rel="noopener" href="https://react.dev/learn/preserving-and-resetting-state">Preserving and Resetting State – React</a></p>
<ul>
<li><p>React 會根據我們設計的 components 生成 <strong>UI Tree</strong>；接著，React DOM 會根據 <strong>UI Tree</strong> 改造瀏覽器端的 <strong>DOM</strong></p>
<p><img src="https://react.dev/_next/image?url=/images/docs/diagrams/preserving_state_dom_tree.png&w=1920&q=75" alt="Diagram with three sections arranged horizontally. In the first section, there are three rectangles stacked vertically, with labels &#39;Component A&#39;, &#39;Component B&#39;, and &#39;Component C&#39;. Transitioning to the next pane is an arrow with the React logo on top labeled &#39;React&#39;. The middle section contains a tree of components, with the root labeled &#39;A&#39; and two children labeled &#39;B&#39; and &#39;C&#39;. The next section is again transitioned using an arrow with the React logo on top labeled &#39;React&#39;. The third and final section is a wireframe of a browser, containing a tree of 8 nodes, which has only a subset highlighted (indicating the subtree from the middle section)."></p>
</li>
<li><p>我們可以<strong>想像</strong> state 是被綁在其所屬元素中，然而，state 事實上是<strong>統一由 React 管理</strong></p>
</li>
<li><p>相異兩個 element 的 state 相互獨立，就算他們使用的是同一個 function component</p>
<img src="https://react.dev/_next/image?url=%2Fimages%2Fdocs%2Fdiagrams%2Fpreserving_state_increment.png&w=1080&q=75" alt="Diagram of a tree of React components. The root node is labeled 'div' and has two children. The left child is labeled 'Counter' and contains a state bubble labeled 'count' with value 0. The right child is labeled 'Counter' and contains a state bubble labeled 'count' with value 1. The state bubble of the right child is highlighted in yellow to indicate its value has updated." style="zoom: 33%;" />
</li>
<li><p>「相同位置」的「相同 component」 可以<strong>保留 state</strong>。此處「位置」是指該 component 在 <strong>UI Tree 的方位</strong>，而非其在 JSX Markup 上的位置。</p>
<img src="https://react.dev/_next/image?url=%2Fimages%2Fdocs%2Fdiagrams%2Fpreserving_state_same_component.png&w=1200&q=75" alt="Diagram with two sections separated by an arrow transitioning between them. Each section contains a layout of components with a parent labeled 'App' containing a state bubble labeled isFancy. This component has one child labeled 'div', which leads to a prop bubble containing isFancy (highlighted in purple) passed down to the only child. The last child is labeled 'Counter' and contains a state bubble with label 'count' and value 3 in both diagrams. In the left section of the diagram, nothing is highlighted and the isFancy parent state value is false. In the right section of the diagram, the isFancy parent state value has changed to true and it is highlighted in yellow, and so is the props bubble below, which has also changed its isFancy value to true." style="zoom: 33%;" />
</li>
<li><p>「相同位置」的「不同 component」相互切換後<strong>無法保留原先的 state</strong></p>
<img src="https://react.dev/_next/image?url=%2Fimages%2Fdocs%2Fdiagrams%2Fpreserving_state_diff_pt1.png&w=1920&q=75" alt="Diagram with three sections, with an arrow transitioning each section in between. The first section contains a React component labeled 'div' with a single child labeled 'Counter' containing a state bubble labeled 'count' with value 3. The middle section has the same 'div' parent, but the child component has now been deleted, indicated by a yellow 'proof' image. The third section has the same 'div' parent again, now with a new child labeled 'p', highlighted in yellow." style="zoom:33%;"/></li>
</ul>
<img src="https://react.dev/_next/image?url=%2Fimages%2Fdocs%2Fdiagrams%2Fpreserving_state_diff_pt2.png&w=1920&q=75" alt="Diagram with three sections, with an arrow transitioning each section in between. The first section contains a React component labeled 'p'. The middle section has the same 'div' parent, but the child component has now been deleted, indicated by a yellow 'proof' image. The third section has the same 'div' parent again, now with a new child labeled 'Counter' containing a state bubble labeled 'count' with value 0, highlighted in yellow." style="zoom:33%;" />

<ul>
<li><p>若要讓「相同位置」的「相同 component」 <strong>重設 state</strong>，有兩種解決辦法：</p>
<ul>
<li><p>讓「相同 component」放置於<strong>「不同位置」</strong></p>
<p><img src="https://react.dev/_next/image?url=%2Fimages%2Fdocs%2Fdiagrams%2Fpreserving_state_diff_position_p1.png&w=1080&q=75" alt="Diagram with a tree of React components. The parent is labeled 'Scoreboard' with a state bubble labeled isPlayerA with value 'true'. The only child, arranged to the left, is labeled Counter with a state bubble labeled 'count' and value 0. All of the left child is highlighted in yellow, indicating it was added." style="zoom:15%;" /><img src="https://react.dev/_next/image?url=%2Fimages%2Fdocs%2Fdiagrams%2Fpreserving_state_diff_position_p2.png&w=1080&q=75" alt="Diagram with a tree of React components. The parent is labeled 'Scoreboard' with a state bubble labeled isPlayerA with value 'false'. The state bubble is highlighted in yellow, indicating that it has changed. The left child is replaced with a yellow 'poof' image indicating that it has been deleted and there is a new child on the right, highlighted in yellow indicating that it was added. The new child is labeled 'Counter' and contains a state bubble labeled 'count' with value 0." style="zoom: 15%;" /><img src="https://react.dev/_next/image?url=%2Fimages%2Fdocs%2Fdiagrams%2Fpreserving_state_diff_position_p3.png&w=1080&q=75" alt="Diagram with a tree of React components. The parent is labeled 'Scoreboard' with a state bubble labeled isPlayerA with value 'true'. The state bubble is highlighted in yellow, indicating that it has changed. There is a new child on the left, highlighted in yellow indicating that it was added. The new child is labeled 'Counter' and contains a state bubble labeled 'count' with value 0. The right child is replaced with a yellow 'poof' image indicating that it has been deleted." style="zoom:15%;" /></p>
</li>
<li><p>使用給予該 component <strong>不同的 keys</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;isPlayerA ? (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Counter</span> <span class="attr">key</span>=<span class="string">&quot;Taylor&quot;</span> <span class="attr">person</span>=<span class="string">&quot;Taylor&quot;</span> /&gt;</span></span></span><br><span class="line">) : (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Counter</span> <span class="attr">key</span>=<span class="string">&quot;Sarah&quot;</span> <span class="attr">person</span>=<span class="string">&quot;Sarah&quot;</span> /&gt;</span></span></span><br><span class="line">)&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="使用-Reducer-於-State"><a href="#使用-Reducer-於-State" class="headerlink" title="使用 Reducer 於 State"></a>使用 Reducer 於 State</h2><p><a target="_blank" rel="noopener" href="https://react.dev/learn/extracting-state-logic-into-a-reducer">Extracting State Logic into a Reducer – React</a></p>
<ul>
<li><p>使用時機：當 state 有<strong>多個更新的時機</strong>，我們可以使用 Reducer 進行集中管理</p>
</li>
<li><p>採用步驟：</p>
<ol>
<li>從 <strong>state-setting</strong> 的模式改成 <strong>action-dispatching</strong></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleAddTask</span>(<span class="params">text</span>) &#123;</span><br><span class="line">  <span class="title function_">dispatch</span>(&#123; <span class="comment">//It is an action object</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;added&#x27;</span>,</span><br><span class="line">    <span class="attr">id</span>: nextId++,</span><br><span class="line">    <span class="attr">text</span>: text,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleChangeTask</span>(<span class="params">task</span>) &#123;</span><br><span class="line">  <span class="title function_">dispatch</span>(&#123; <span class="comment">//It is an action object</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;changed&#x27;</span>,</span><br><span class="line">    <span class="attr">task</span>: task,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleDeleteTask</span>(<span class="params">taskId</span>) &#123;</span><br><span class="line">  <span class="title function_">dispatch</span>(&#123; <span class="comment">//It is an action object</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;deleted&#x27;</span>,</span><br><span class="line">    <span class="attr">id</span>: taskId,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>宣告一個 reducer function</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">tasksReducer</span>(<span class="params">tasks, action</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&#x27;added&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      ...tasks,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: action.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">text</span>: action.<span class="property">text</span>,</span><br><span class="line">        <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ];</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&#x27;changed&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> tasks.<span class="title function_">map</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (t.<span class="property">id</span> === action.<span class="property">task</span>.<span class="property">id</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> action.<span class="property">task</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&#x27;deleted&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> tasks.<span class="title function_">filter</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> t.<span class="property">id</span> !== action.<span class="property">id</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="title class_">Error</span>(<span class="string">&#x27;Unknown action: &#x27;</span> + action.<span class="property">type</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>將 <code>useState()</code> 改為 <code>useReducer()</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ARGUMENTS:</span></span><br><span class="line">	<span class="comment">// a reducer function</span></span><br><span class="line">	<span class="comment">// an initial state</span></span><br><span class="line"><span class="comment">// RETURN:</span></span><br><span class="line">	<span class="comment">// tasks: A stateful value</span></span><br><span class="line">	<span class="comment">// dispatch: A dispatch function (to “dispatch” user actions to the reducer)</span></span><br><span class="line"><span class="keyword">import</span> &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> [tasks, dispatch] = <span class="title function_">useReducer</span>(tasksReducer, initialTasks);</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="用-Context-傳遞資料"><a href="#用-Context-傳遞資料" class="headerlink" title="用 Context 傳遞資料"></a>用 Context 傳遞資料</h2><p><a target="_blank" rel="noopener" href="https://react.dev/learn/passing-data-deeply-with-context">Passing Data Deeply with Context – React</a></p>
<ul>
<li><p><strong>使用時機：</strong></p>
<ul>
<li>某些資料從 parent 傳到 child 可能會需要<strong>太多層</strong>，透過使用 Context ，我們可以免去傳 props 的麻煩</li>
<li>The nearest common ancestor could be far removed from the components that need data, and <a target="_blank" rel="noopener" href="https://react.dev/learn/sharing-state-between-components">lifting state up</a> that high can lead to a situation called <strong>“prop drilling”.</strong></li>
</ul>
</li>
<li><p><strong>使用步驟：</strong></p>
<ol>
<li><p>從新的檔案<strong>創建</strong> context </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">LevelContext</span> = <span class="title function_">createContext</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 component <strong>使用</strong> context</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LevelContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./LevelContext.js&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Heading</span>(<span class="params">&#123; children &#125;</span>) &#123; <span class="comment">// NO NEED to pass level as prop</span></span><br><span class="line">  <span class="keyword">const</span> level = <span class="title function_">useContext</span>(<span class="title class_">LevelContext</span>);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 parent component <strong>提供</strong> context [^1]</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LevelContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./LevelContext.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Section</span>(<span class="params">&#123; level, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">&quot;section&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">LevelContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;level&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">LevelContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>對於多個巢狀且相同的 component，我們原先需要手動指定每一層的 level</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Section level=&#123;1&#125;&gt;</span><br><span class="line">      ...</span><br><span class="line">      &lt;Section level=&#123;2&#125;&gt;</span><br><span class="line">        ...</span><br><span class="line">        &lt;Section level=&#123;3&#125;&gt;</span><br><span class="line">          ...</span><br></pre></td></tr></table></figure>

<p>透過 context，<strong>每一個 section 可以取得上層 level 的數值</strong>，並且將 level + 1 傳遞下去，免去傳送 props 的過程</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LevelContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./LevelContext.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Section</span>(<span class="params">&#123; children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> level = <span class="title function_">useContext</span>(<span class="title class_">LevelContext</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">&quot;section&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">LevelContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;level</span> + <span class="attr">1</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">LevelContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>[^1]: This tells React: “if any component inside this &lt;Section&gt; asks for LevelContext, give them this level.” The component will use the value of the nearest &lt;LevelContext.Provider&gt; in the UI tree above it.</p>
</li>
<li><p><strong>使用 context 前的注意事項</strong>：</p>
<ul>
<li><p>先從<strong>傳 props</strong>開始做起，不是所有的資料都適合 context</p>
</li>
<li><p>對沒有用到該 prop 的 component，可以直接<strong>用 child component 當作 prop</strong> (<a target="_blank" rel="noopener" href="https://react.dev/learn/passing-props-to-a-component#passing-jsx-as-children">Passing JSX as children</a>)</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Bad</span></span><br><span class="line">&lt;<span class="title class_">Layout</span> posts=&#123;posts&#125; /&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Good. It will reduce the number of layers</span></span><br><span class="line">&lt;<span class="title class_">Layout</span>&gt;<span class="language-xml"><span class="tag">&lt;<span class="name">Posts</span> <span class="attr">posts</span>=<span class="string">&#123;posts&#125;</span> /&gt;</span></span>&lt;/<span class="title class_">Layout</span>&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>使用時機舉例</strong>：網頁主題、帳號資訊、Routing、State Management……</p>
</li>
</ul>
<h2 id="使用-Reducer-於-Context"><a href="#使用-Reducer-於-Context" class="headerlink" title="使用 Reducer 於 Context"></a>使用 Reducer 於 Context</h2><p><a target="_blank" rel="noopener" href="https://react.dev/learn/scaling-up-with-reducer-and-context">Scaling Up with Reducer and Context – React</a></p>
<ul>
<li><p><strong>使用時機</strong>：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ARGUMENTS:</span></span><br><span class="line">	<span class="comment">// a reducer function</span></span><br><span class="line">	<span class="comment">// an initial state</span></span><br><span class="line"><span class="comment">// RETURN:</span></span><br><span class="line">	<span class="comment">// tasks: A stateful value</span></span><br><span class="line">	<span class="comment">// dispatch: A dispatch function (to “dispatch” user actions to the reducer)</span></span><br><span class="line"><span class="keyword">import</span> &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> [tasks, dispatch] = <span class="title function_">useReducer</span>(tasksReducer, initialTasks);</span><br></pre></td></tr></table></figure>

<ul>
<li>目前 tasks 和 dispatch 都只能在<strong>上層的 component</strong> 被使用，若要使 child components 可以存取該 reducer，我們必須得要透過<strong>傳遞 props 的方式</strong>。</li>
<li>透過 context 與 reducer 的結合，我們可以避免 reducer 相關函數及資料<strong>傳遞太多層</strong>的問題</li>
</ul>
</li>
<li><p><strong>使用步驟：</strong></p>
<ol>
<li><p>從新的檔案<strong>創建</strong> context </p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Provides the current list of tasks</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">TasksContext</span> = <span class="title function_">createContext</span>(<span class="literal">null</span>); </span><br><span class="line"><span class="comment">// Provides the function that lets components dispatch actions</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">TasksDispatchContext</span> = <span class="title function_">createContext</span>(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>將 <code>useReducer </code>所提供的 state 和 dispatch 函數<strong>放入 context</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TasksContext</span>, <span class="title class_">TasksDispatchContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./TasksContext.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TaskApp</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [tasks, dispatch] = <span class="title function_">useReducer</span>(tasksReducer, initialTasks);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">TasksContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;tasks&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">TasksDispatchContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;dispatch&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ...</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">TasksDispatchContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">TasksContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <strong>subtree</strong> 中使用 context</p>
<ul>
<li>對於  <code>&lt;AddTask /&gt;  </code>與 <code>&lt;TaskList /&gt;</code>，我們<strong>不需要再傳入所需的 props</strong></li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//外層 </span></span><br><span class="line">&lt;<span class="title class_">TasksContext</span>.<span class="property">Provider</span> value=&#123;tasks&#125;&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">TasksDispatchContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;dispatch&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Day off in Kyoto<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">AddTask</span> /&gt;</span> </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">TaskList</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">TasksDispatchContext.Provider</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">TasksContext</span>.<span class="property">Provider</span>&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>我們轉而使用 <code>useContext</code> 存取所需的內容</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//TaskList</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TaskList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> tasks = <span class="title function_">useContext</span>(<span class="title class_">TasksContext</span>);</span><br><span class="line">  <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AddTask</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">AddTask</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [text, setText] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="title function_">useContext</span>(<span class="title class_">TasksDispatchContext</span>);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">      setText(&#x27;&#x27;);</span></span><br><span class="line"><span class="language-xml">      dispatch(&#123;</span></span><br><span class="line"><span class="language-xml">        type: &#x27;added&#x27;,</span></span><br><span class="line"><span class="language-xml">        id: nextId++,</span></span><br><span class="line"><span class="language-xml">        text: text,</span></span><br><span class="line"><span class="language-xml">      &#125;);</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;&gt;Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    <span class="comment">// ...</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p><strong>小撇步：</strong> </p>
<ul>
<li>將 reducer 和 context **整合成一個檔案 (下例的 TextContext.js) **，該檔案可以：<ul>
<li>運用 reducer 管理 states</li>
<li>同時提供 context 和 components</li>
<li>可以傳入 JSX 到 <code>TasksProvider</code> 中</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//App.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">AddTask</span> <span class="keyword">from</span> <span class="string">&#x27;./AddTask.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">TaskList</span> <span class="keyword">from</span> <span class="string">&#x27;./TaskList.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TasksProvider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./TasksContext.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TaskApp</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">TasksProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Day off in Kyoto<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">AddTask</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">TaskList</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">TasksProvider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TextContext.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createContext, useReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">TasksContext</span> = <span class="title function_">createContext</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">TasksDispatchContext</span> = <span class="title function_">createContext</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">TasksProvider</span>(<span class="params">&#123; children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [tasks, dispatch] = <span class="title function_">useReducer</span>(</span><br><span class="line">    tasksReducer,</span><br><span class="line">    initialTasks</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">TasksContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;tasks&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">TasksDispatchContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;dispatch&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">TasksDispatchContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">TasksContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">tasksReducer</span>(<span class="params">tasks, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;added&#x27;</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> [...tasks, &#123;</span><br><span class="line">        <span class="attr">id</span>: action.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">text</span>: action.<span class="property">text</span>,</span><br><span class="line">        <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">      &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;changed&#x27;</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> tasks.<span class="title function_">map</span>(<span class="function"><span class="params">t</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (t.<span class="property">id</span> === action.<span class="property">task</span>.<span class="property">id</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> action.<span class="property">task</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> t;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;deleted&#x27;</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> tasks.<span class="title function_">filter</span>(<span class="function"><span class="params">t</span> =&gt;</span> t.<span class="property">id</span> !== action.<span class="property">id</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attr">default</span>: &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="title class_">Error</span>(<span class="string">&#x27;Unknown action: &#x27;</span> + action.<span class="property">type</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initialTasks = [</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">text</span>: <span class="string">&#x27;Philosopher’s Path&#x27;</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">&#x27;Visit the temple&#x27;</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">&#x27;Drink matcha&#x27;</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<ul>
<li>此外，我們可以額外自定義 [<strong>custom hooks</strong>][<a target="_blank" rel="noopener" href="https://react.dev/learn/reusing-logic-with-custom-hooks]%EF%BC%8C%E8%AE%93">https://react.dev/learn/reusing-logic-with-custom-hooks]，讓</a> components 隨後可以直接呼叫並使用 context</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useTasks</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useContext</span>(<span class="title class_">TasksContext</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useTasksDispatch</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useContext</span>(<span class="title class_">TasksDispatchContext</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/imbensonchiu">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#State-%E7%9A%84%E4%BA%94%E5%A4%A7%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%89%87"><span class="toc-number">1.</span> <span class="toc-text">State 的五大使用原則</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Components-%E9%96%93%E5%85%B1%E4%BA%AB-state-%E7%9A%84%E6%A9%9F%E5%88%B6"><span class="toc-number">2.</span> <span class="toc-text">Components 間共享 state 的機制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%87-state-%E6%8A%AC%E5%8D%87%E7%9A%84%E4%B8%89%E5%80%8B%E6%AD%A5%E9%A9%9F"><span class="toc-number">2.1.</span> <span class="toc-text">將 state 抬升的三個步驟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%9CSingle-Source-of-Truth%E2%80%9D-Architecture"><span class="toc-number">2.2.</span> <span class="toc-text">“Single Source of Truth” Architecture</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%9D%E7%95%99%E8%88%87%E9%87%8D%E8%A8%AD-state-%E7%9A%84%E6%A9%9F%E5%88%B6"><span class="toc-number">3.</span> <span class="toc-text">保留與重設 state 的機制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Reducer-%E6%96%BC-State"><span class="toc-number">4.</span> <span class="toc-text">使用 Reducer 於 State</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8-Context-%E5%82%B3%E9%81%9E%E8%B3%87%E6%96%99"><span class="toc-number">5.</span> <span class="toc-text">用 Context 傳遞資料</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Reducer-%E6%96%BC-Context"><span class="toc-number">6.</span> <span class="toc-text">使用 Reducer 於 Context</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&text=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&title=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&is_video=false&description=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=[網頁前端] React 學習筆記 - Managing States&body=Check out this article: http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&title=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&title=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&title=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&title=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&name=[網頁前端] React 學習筆記 - Managing States&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://bensonchiulearning.github.io/Computer-Science/20230727/0727-state_management_in_react/&t=[網頁前端] React 學習筆記 - Managing States"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023
    Benson Chiu
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/imbensonchiu">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
